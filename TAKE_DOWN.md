## 前言

#### 项目的初衷
这个项目的本意是我用来学习一些技术所开启的。

#### 为什么开发的是一个聊天软件（虽然现在还看不出来）
因为我觉得聊天软件是一个很有挑战的项目，在开始这个项目之前我只知道要先和服务器建立一个ws的连接，然后什么都不知道😂

到现在来说我觉得我是想法是对的，这真的是一个很有挑战的项目，不过前提是要建立在这些知识点上(桌面开发，UI设计，项目的架构设计，后端的架构设计，数据库的选型和使用，前后端通信的安全技术等等)

#### 这个项目为什么开发得这么慢
这个项目开发得慢的一个原因是这个项目只有我一人在开发，但我觉得多人开发的话需要搞很多统一性问题(っ °Д °;)っ，后续再看看吧

一个人开发其实不是慢的主要原因，主要的是很多技术我并不会，甚至不了解，开发成本增大了很多。不过这就是我想要的，因为我是为了学习而开始的，如果来了一个大佬，把所有东西都搞好了，那我还开发个啥子@_@

## 进度

#### 2022/07/24
追加一个test文件夹，准备实现一下BrowerService。
设计思路：添加一个用来开服务的线程，将页面的多个功能变成一个一个的服务，并再另一个线程中启动，以优化资源，分担一下electron的那俩个线程的负担

参考了这篇文章[https://juejin.cn/post/7045081514597416991#heading-0](https://juejin.cn/post/7045081514597416991#heading-0)

BrowerService为一个无ui无大小不显示可以运行electron和node的api和部分前端才有的对象(file, forch, window...)的线程，相当于一个万能的进程，功能有很多提前加载资源，提前渲染部分页面...

BrowerService之间还是使用ipcMain和ipcRender来通信(node原生的ipc试了很久还是不会，后面再看吧)

#### 2022/07/25

- 添加进程管理服务，结合进程集合表实现
- 准备实现服务的动态加载

#### 2022/07/27

隔了一天，再写进程可视化操作服务

修改：
- 将进程集合转移到主进程，所有进程的管理转移到主进程
- 添加一个新的服务，ProcessVisualization(进程可视化)，它会在启动的时候打开一个管理的窗口(由服务进程打开)，会通过ipc把进程数据发送到该进程，在该进程进行进程操作，不过所有的操作都是通过ipc发送到主进程来进行的

##### 优化部分代码：

- 所有服务的加载使用了新的方法
```js
function loadService(filePath) {
    const modulePath = join(dirname(dirname(__dirname)), "./services", filePath)

    require(modulePath)
    delete require.cache[modulePath]
}
```
- 将进程的创建改为```new BorwserService()```且只能在主进程中调用，因为进程集合已经转移到了主进程，这样方便一点。当服务进程要开启新的服务的时候应该通过```ipcRenderer.send("createBrowserService")```或```ipcRenderer.send("createServiceWindow")```触发
- 给服务进程实例对象添加多个信息属性，并实现一个类俩用，既可以是服务进程，也可以是服务窗口进程

##### 现状
还在实现进程管理可视化的功能，可视化功能还有一个bug，有时运行的时候会不触发事件，导致窗口没打开

#### 2022/08/02
已经到8月了，过去5天了
进展：
###### 完成的
- 重新实现接口请求函数的文件，通过node的child_proces开启一个新的子进程去运行它，再通过process对象的ipc通信实现接口请求
- 渲染进程可通过预加载脚本中写好的方法来对新开启的接口请求函数进程进行服务器请求
- 通过渲染进程的预加载脚本，将主进程中加载好的app独有的环境变量转移到渲染进程
- 渲染进程通过主进程转移环境变量这一操作将要开启的进程信息绑定到主进程环境变量上，再渲染进程发送回去配置进程信息
- 修改服务进程类的资源加载逻辑，如果是想直接加载.js文件则URL参数为.js的绝对路径，如果是.html文件则URL参数需要带上file:///协议或者自定义的地址 这样做的目的是如果开发期间所有了类似vite热加载开发的话，可以直接传递地址，实现热加载
- 添加用户本地配置文件的加载 /src/lib/LocalDatabase/user_config.js 这个文件会在app触发ready事件后执行，后期可以会转移执行的地方

###### 待实现的
- 添加本地数据库的增删查改操作，本地数据库就俩张表，一张是用户的消息聊天记录，另一个是用户的聊天列表，按照原本的架构设计，本地是还有一张好友列表的，但是这张表可有可无，因为服务端已经存储了，并且如果有好友列表也不会配置具体的好友信息，因为当好友修改信息的时候服务器和客户端都需要做大量的修改，因此直接kill
- 实现本地数据库的增删改查后再开启一个本地操作的进程，目的也是为了分担主进程的负担
- 将俩个工具进程的进程信息添加到进程信息数据中
- 实现WebSocket通信

###### 屁话
因为更换的软件在electron中的架构，所以还需要做大量的适配工作，UI部分目前暂不做打算，等到架构适配好了后再重新设计UI部分

#### 2022/08/09
APP的后台架构整体已经实现了

APP的所有类型的进程：electron内置进程(主进程，渲染进程，CPU，工具)， 服务进程(底层还是electron的渲染进程)，工具进程(底层是Node的内置的child_process中fork出来的进程，适用于运行不需要electron环境的文件)

APP目前全功率运行会开启8个进程，其中三个为工具进程，俩个为服务进程，其他就是electron内置的进程

#### 正在做的
通过制作部分UI来测试一下后台的架构有没有bug

#### 2022/09/18
本项目的多进程架构已经很完善了，项目的打包配置也已经实现，已经可以打包成一个正常APP的安装包
剔除了很多多余的东西，将代码的位置转移到更加合理的地方，对部分功能的实现更加的模块化和可自定义化
后期这个多进程架构完全可以变成一个electron多进程开发框架

UI也已经基本成型，工具中的操作方法也做了部分更改和适配

#### 正在做的
提示软件的使用体验和解决部分隐藏的bug

#### 后期打算
给项目添加一个和vscode差不多的扩展进程，并将后台的架构独立出来变成一个开源包